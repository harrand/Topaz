<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Topaz: Shaders</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="tz.png"/></td>
  <td id="projectalign">
   <div id="projectname">Topaz<span id="projectnumber">&#160;3.2</span>
   </div>
   <div id="projectbrief">C++20 Graphics Engine</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('shaders.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Shaders </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="tzsl"></a>
Topaz Shader Language</h1>
<h1><a class="anchor" id="Introduction"></a>
Introduction</h1>
<p >TZSL is a high-level shading language with a syntax very similar to the OpenGL Shading Language (GLSL). While GLSL has slightly different dialects for different render APIs (such as OpenGL and Vulkan), TZSL shaders can be used for all render-API builds.</p>
<p >TZSL has a bespoke syntax for specifying shader resources. This is because shader resources are concrete and first-class objects as far as topaz renderers are concerned.</p>
<h1><a class="anchor" id="Language"></a>
Language</h1>
<h2><a class="anchor" id="Preprocessor"></a>
Definitions</h2>
<p >A number of preprocessor definitions are guaranteed to be exist for all TZSL shaders. These are always defined, but their value depends on the build parameters of the target program.</p>
<p >Below are the defines whose value depends on the render-api: </p><table class="doxtable">
<tr>
<th>Define </th><th>Value (OpenGL) </th><th>Value (Vulkan)  </th></tr>
<tr>
<td>TZ_VULKAN </td><td style="text-align: center;">0 </td><td style="text-align: center;">1  </td></tr>
<tr>
<td>TZ_OGL </td><td style="text-align: center;">1 </td><td style="text-align: center;">0  </td></tr>
</table>
<p >Below are the defines whose value depends on the build-config: </p><table class="doxtable">
<tr>
<th>Define </th><th>Value (Debug) </th><th>Value (Release)  </th></tr>
<tr>
<td>TZ_DEBUG </td><td style="text-align: center;">1 </td><td style="text-align: center;">0  </td></tr>
</table>
<p>Just for clarity, these are preprocessor definitions as in GLSL or C. These are useful if you want your shader to act differently on certain build configurations, but without having to write different shaders.</p>
<h3><a class="anchor" id="ex0"></a>
Example Fragment Shader</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma shader_stage(fragment)</span></div>
<div class="line">layout(location = 0) out vec4 frag_colour;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> main()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Output is a solid colour. Red if we&#39;re on Vulkan, otherwise white.</span></div>
<div class="line"><span class="preprocessor"> #if TZ_VULKAN</span></div>
<div class="line">    frag_colour = vec4(1.0, 0.0, 0.0, 1.0);</div>
<div class="line"><span class="preprocessor"> #else</span></div>
<div class="line">    frag_colour = vec4(1.0, 1.0, 1.0, 1.0);</div>
<div class="line"><span class="preprocessor"> #endif</span></div>
<div class="line">}</div>
</div><!-- fragment --> <h2><a class="anchor" id="Keywords"></a>
Keywords</h2>
<p >TZSL has special reserved keywords. Some keywords compile down directly into GLSL depending on the target render-api: </p><table class="doxtable">
<tr>
<th>TZSL Keyword </th><th>OGL </th><th>VK  </th></tr>
<tr>
<td>tz_VertexID </td><td>gl_VertexID </td><td>gl_VertexIndex  </td></tr>
</table>
<h2><a class="anchor" id="Resources"></a>
Resources</h2>
<p >When writing a shader, you will know about the shader resources it has access to. You might be used to the following syntaxes in OpenGL: </p><div class="fragment"><div class="line">uniform sampler2D my_image;</div>
<div class="line">layout(binding = 0) uniform MyUniformBuffer</div>
<div class="line">{</div>
<div class="line"> ...</div>
<div class="line">} buf;</div>
</div><!-- fragment --><p> Note that the syntax for specifying image and buffer resources are quite different. Because image and buffer resources are first-class objects as far as Topaz renderers are concerned, the syntax is unified and obvious: </p><div class="fragment"><div class="line">resource(<span class="keywordtype">id</span> = 0) const texture my_image;</div>
<div class="line">resource(<span class="keywordtype">id</span> = 0) const buffer MyUniformBuffer</div>
<div class="line">{</div>
<div class="line">    ...</div>
<div class="line">} buf;</div>
</div><!-- fragment --><p> Note that specifying resource ids for shader resources is mandatory, regardless of resource type. The resource id is constant and corresponds to the tz::gl::ResourceHandle when being specified to a renderer. This means that resources have unique identifiers. That is, if a vertex shader specifies an image resource at id 0, and again in a fragment shader (within the same shader program), they both refer to the same resource.</p>
<p >Note: The example above is actually ill-formed &ndash; An image and buffer resource are specified, but they share the same id which is impossible; a resource is either a buffer or an image resource, never both. </p>
<h1><a class="anchor" id="bif"></a>
Built-in Functions</h1>
<h2><a class="anchor" id="bif_printf"></a>
tz_printf</h2>
<p ><code>void tz_printf(fmt: string-literal, ...)</code> </p><dl class="section note"><dt>Note</dt><dd>This is only available for Vulkan Debug builds. Otherwise, compiles down to no-op.</dd></dl>
<p>Specifies a debug-printf statement. The syntax is c-like. Intuitively you might expect the printed output to be sent to the host program's stdout. This is not the case. At present, you can only view these in graphics debuggers which support the vulkan <code>debugPrintfEXT</code>, namely RenderDoc.</p>
<p >The frequency of this output logically matches that of the context. If for example you're invoking <code>tz_printf</code> in a vertex shader's main function, a message will be emitted for each vertex drawn.</p>
<p >To view the output message in RenderDoc: </p><ol>
<li>
Capture a frame using a renderer that uses a shader with this debug output. Ensure the host program is Vulkan Debug. </li>
<li>
In the 'Event Browser', navigate to the draw call that invokes the shader. </li>
<li>
You should see 'X msg(s)' annotated on the draw call. Click on this to see each printf invocation. </li>
</ol>
<h3><a class="anchor" id="tz_printf_params"></a>
Parameters</h3>
<p >The parameters are much like C <code>printf</code>:</p><ul>
<li>String-literal specifying how to interpret the data. Regarding scalar types, format modifiers match that of C's <code>printf</code> function. However, format modifiers also exist for the built-in GLSL vector types.<ul>
<li>Format for specifier is "%"precision &lt;d, i, o, u, x, X, a, A, e, E, f, F, g, G, ul, lu, lx&gt;</li>
<li>Format for vector specifier is "%"precision"v" [2, 3, 4] [specifiers above]</li>
</ul>
</li>
<li>Arguments specifying data to print. There must be an entry for each format modifier within the format string. Like <code>printf</code>, if no modifiers were specified in the format string, this parameter can be omitted. </li>
</ul>
<h3><a class="anchor" id="debug_printf_example"></a>
Examples</h3>
<p >Here are a few example usages: </p><div class="fragment"><div class="line"><span class="keywordtype">float</span> myfloat = 3.1415f;</div>
<div class="line">vec4 floatvec = vec4(1.2f, 2.2f, 3.2f, 4.2f);</div>
<div class="line">uint64_t bigvar = 0x2000000000000001ul;</div>
<div class="line"> </div>
<div class="line">tz_printf(<span class="stringliteral">&quot;Here&#39;s a float value with full precision %f&quot;</span>, myfloat);</div>
<div class="line">tz_printf(<span class="stringliteral">&quot;Here&#39;s a float value to 2 decimal places %1.2f&quot;</span>, myfloat);</div>
<div class="line">tz_printf(<span class="stringliteral">&quot;Here&#39;s a vector of floats %1.2v4f&quot;</span>, floatvec);</div>
<div class="line">tz_printf(<span class="stringliteral">&quot;Unsigned long as decimal %lu and as hex 0x%lx&quot;</span>, bigvar, bigvar);</div>
</div><!-- fragment --><p> Outputs: </p><div class="fragment"><div class="line">Here&#39;s a float value with full precision 3.141500</div>
<div class="line">Here&#39;s a float value to 2 decimal places 3.14</div>
<div class="line">Here&#39;s a vector of floats 1.20, 2.20, 3.20, 4.20</div>
<div class="line">Unsigned long as decimal 2305843009213693953 and as hex 0x2000000000000001</div>
</div><!-- fragment --> <hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
